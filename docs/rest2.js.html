<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>rest2.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="RESTv1.html">RESTv1</a><ul class='methods'><li data-type='method'><a href="RESTv1.html#account_infos">account_infos</a></li><li data-type='method'><a href="RESTv1.html#active_credits">active_credits</a></li><li data-type='method'><a href="RESTv1.html#active_offers">active_offers</a></li><li data-type='method'><a href="RESTv1.html#active_orders">active_orders</a></li><li data-type='method'><a href="RESTv1.html#active_positions">active_positions</a></li><li data-type='method'><a href="RESTv1.html#balance_history">balance_history</a></li><li data-type='method'><a href="RESTv1.html#cancel_all_orders">cancel_all_orders</a></li><li data-type='method'><a href="RESTv1.html#cancel_multiple_orders">cancel_multiple_orders</a></li><li data-type='method'><a href="RESTv1.html#cancel_offer">cancel_offer</a></li><li data-type='method'><a href="RESTv1.html#cancel_order">cancel_order</a></li><li data-type='method'><a href="RESTv1.html#claim_position">claim_position</a></li><li data-type='method'><a href="RESTv1.html#close_swap">close_swap</a></li><li data-type='method'><a href="RESTv1.html#fundingbook">fundingbook</a></li><li data-type='method'><a href="RESTv1.html#get_symbols">get_symbols</a></li><li data-type='method'><a href="RESTv1.html#lends">lends</a></li><li data-type='method'><a href="RESTv1.html#margin_infos">margin_infos</a></li><li data-type='method'><a href="RESTv1.html#movements">movements</a></li><li data-type='method'><a href="RESTv1.html#multiple_new_orders">multiple_new_orders</a></li><li data-type='method'><a href="RESTv1.html#new_deposit">new_deposit</a></li><li data-type='method'><a href="RESTv1.html#new_offer">new_offer</a></li><li data-type='method'><a href="RESTv1.html#new_order">new_order</a></li><li data-type='method'><a href="RESTv1.html#offer_status">offer_status</a></li><li data-type='method'><a href="RESTv1.html#order_status">order_status</a></li><li data-type='method'><a href="RESTv1.html#orderbook">orderbook</a></li><li data-type='method'><a href="RESTv1.html#orders_history">orders_history</a></li><li data-type='method'><a href="RESTv1.html#past_trades">past_trades</a></li><li data-type='method'><a href="RESTv1.html#replace_order">replace_order</a></li><li data-type='method'><a href="RESTv1.html#stats">stats</a></li><li data-type='method'><a href="RESTv1.html#symbols_details">symbols_details</a></li><li data-type='method'><a href="RESTv1.html#taken_swaps">taken_swaps</a></li><li data-type='method'><a href="RESTv1.html#ticker">ticker</a></li><li data-type='method'><a href="RESTv1.html#today">today</a></li><li data-type='method'><a href="RESTv1.html#total_taken_swaps">total_taken_swaps</a></li><li data-type='method'><a href="RESTv1.html#trades">trades</a></li><li data-type='method'><a href="RESTv1.html#transfer">transfer</a></li><li data-type='method'><a href="RESTv1.html#wallet_balances">wallet_balances</a></li><li data-type='method'><a href="RESTv1.html#withdraw">withdraw</a></li></ul></li><li><a href="RESTv2.html">RESTv2</a><ul class='methods'><li data-type='method'><a href="RESTv2.html#accountFees">accountFees</a></li><li data-type='method'><a href="RESTv2.html#accountSummary">accountSummary</a></li><li data-type='method'><a href="RESTv2.html#accountTrades">accountTrades</a></li><li data-type='method'><a href="RESTv2.html#activeOrders">activeOrders</a></li><li data-type='method'><a href="RESTv2.html#activeOrdersWithIds">activeOrdersWithIds</a></li><li data-type='method'><a href="RESTv2.html#addPulse">addPulse</a></li><li data-type='method'><a href="RESTv2.html#addPulseComment">addPulseComment</a></li><li data-type='method'><a href="RESTv2.html#alertDelete">alertDelete</a></li><li data-type='method'><a href="RESTv2.html#alertList">alertList</a></li><li data-type='method'><a href="RESTv2.html#alertSet">alertSet</a></li><li data-type='method'><a href="RESTv2.html#calcAvailableBalance">calcAvailableBalance</a></li><li data-type='method'><a href="RESTv2.html#cancelAllFundingOffers">cancelAllFundingOffers</a></li><li data-type='method'><a href="RESTv2.html#cancelFundingOffer">cancelFundingOffer</a></li><li data-type='method'><a href="RESTv2.html#cancelOrder">cancelOrder</a></li><li data-type='method'><a href="RESTv2.html#cancelOrderMulti">cancelOrderMulti</a></li><li data-type='method'><a href="RESTv2.html#cancelOrders">cancelOrders</a></li><li data-type='method'><a href="RESTv2.html#cancelOrderWithCid">cancelOrderWithCid</a></li><li data-type='method'><a href="RESTv2.html#candles">candles</a></li><li data-type='method'><a href="RESTv2.html#changeLogs">changeLogs</a></li><li data-type='method'><a href="RESTv2.html#claimPosition">claimPosition</a></li><li data-type='method'><a href="RESTv2.html#closeFunding">closeFunding</a></li><li data-type='method'><a href="RESTv2.html#closePosition">closePosition</a></li><li data-type='method'><a href="RESTv2.html#conf">conf</a></li><li data-type='method'><a href="RESTv2.html#currencies">currencies</a></li><li data-type='method'><a href="RESTv2.html#deletePulse">deletePulse</a></li><li data-type='method'><a href="RESTv2.html#deleteSettings">deleteSettings</a></li><li data-type='method'><a href="RESTv2.html#derivsPositionCollateralSet">derivsPositionCollateralSet</a></li><li data-type='method'><a href="RESTv2.html#exchangeRate">exchangeRate</a></li><li data-type='method'><a href="RESTv2.html#fetchPulseComments">fetchPulseComments</a></li><li data-type='method'><a href="RESTv2.html#fundingCreditHistory">fundingCreditHistory</a></li><li data-type='method'><a href="RESTv2.html#fundingCredits">fundingCredits</a></li><li data-type='method'><a href="RESTv2.html#fundingInfo">fundingInfo</a></li><li data-type='method'><a href="RESTv2.html#fundingLoanHistory">fundingLoanHistory</a></li><li data-type='method'><a href="RESTv2.html#fundingLoans">fundingLoans</a></li><li data-type='method'><a href="RESTv2.html#fundingOfferHistory">fundingOfferHistory</a></li><li data-type='method'><a href="RESTv2.html#fundingOffers">fundingOffers</a></li><li data-type='method'><a href="RESTv2.html#fundingTrades">fundingTrades</a></li><li data-type='method'><a href="RESTv2.html#futures">futures</a></li><li data-type='method'><a href="RESTv2.html#generateInvoice">generateInvoice</a></li><li data-type='method'><a href="RESTv2.html#generateToken">generateToken</a></li><li data-type='method'><a href="RESTv2.html#getCoreSettings">getCoreSettings</a></li><li data-type='method'><a href="RESTv2.html#getDepositAddress">getDepositAddress</a></li><li data-type='method'><a href="RESTv2.html#getSettings">getSettings</a></li><li data-type='method'><a href="RESTv2.html#getURL">getURL</a></li><li data-type='method'><a href="RESTv2.html#inactiveSymbols">inactiveSymbols</a></li><li data-type='method'><a href="RESTv2.html#invalidateAuthToken">invalidateAuthToken</a></li><li data-type='method'><a href="RESTv2.html#keepFunding">keepFunding</a></li><li data-type='method'><a href="RESTv2.html#keyPermissions">keyPermissions</a></li><li data-type='method'><a href="RESTv2.html#ledgers">ledgers</a></li><li data-type='method'><a href="RESTv2.html#liquidations">liquidations</a></li><li data-type='method'><a href="RESTv2.html#logins">logins</a></li><li data-type='method'><a href="RESTv2.html#marginInfo">marginInfo</a></li><li data-type='method'><a href="RESTv2.html#marketAveragePrice">marketAveragePrice</a></li><li data-type='method'><a href="RESTv2.html#movements">movements</a></li><li data-type='method'><a href="RESTv2.html#orderBook">orderBook</a></li><li data-type='method'><a href="RESTv2.html#orderHistory">orderHistory</a></li><li data-type='method'><a href="RESTv2.html#orderHistoryWithIds">orderHistoryWithIds</a></li><li data-type='method'><a href="RESTv2.html#orderMultiOp">orderMultiOp</a></li><li data-type='method'><a href="RESTv2.html#orderTrades">orderTrades</a></li><li data-type='method'><a href="RESTv2.html#payDeposits">payDeposits</a></li><li data-type='method'><a href="RESTv2.html#payDepositsUnlinked">payDepositsUnlinked</a></li><li data-type='method'><a href="RESTv2.html#payInvoiceComplete">payInvoiceComplete</a></li><li data-type='method'><a href="RESTv2.html#payInvoiceCreate">payInvoiceCreate</a></li><li data-type='method'><a href="RESTv2.html#payInvoiceExpire">payInvoiceExpire</a></li><li data-type='method'><a href="RESTv2.html#payInvoiceList">payInvoiceList</a></li><li data-type='method'><a href="RESTv2.html#payInvoiceListPaginated">payInvoiceListPaginated</a></li><li data-type='method'><a href="RESTv2.html#performance">performance</a></li><li data-type='method'><a href="RESTv2.html#positions">positions</a></li><li data-type='method'><a href="RESTv2.html#positionsAudit">positionsAudit</a></li><li data-type='method'><a href="RESTv2.html#positionsHistory">positionsHistory</a></li><li data-type='method'><a href="RESTv2.html#positionsSnapshot">positionsSnapshot</a></li><li data-type='method'><a href="RESTv2.html#publicPulseHistory">publicPulseHistory</a></li><li data-type='method'><a href="RESTv2.html#publicPulseProfile">publicPulseProfile</a></li><li data-type='method'><a href="RESTv2.html#pulseHistory">pulseHistory</a></li><li data-type='method'><a href="RESTv2.html#stats">stats</a></li><li data-type='method'><a href="RESTv2.html#status">status</a></li><li data-type='method'><a href="RESTv2.html#statusMessages">statusMessages</a></li><li data-type='method'><a href="RESTv2.html#submitAutoFunding">submitAutoFunding</a></li><li data-type='method'><a href="RESTv2.html#submitFundingOffer">submitFundingOffer</a></li><li data-type='method'><a href="RESTv2.html#submitOrder">submitOrder</a></li><li data-type='method'><a href="RESTv2.html#submitOrderMulti">submitOrderMulti</a></li><li data-type='method'><a href="RESTv2.html#symbolDetails">symbolDetails</a></li><li data-type='method'><a href="RESTv2.html#symbols">symbols</a></li><li data-type='method'><a href="RESTv2.html#ticker">ticker</a></li><li data-type='method'><a href="RESTv2.html#tickers">tickers</a></li><li data-type='method'><a href="RESTv2.html#tickersHistory">tickersHistory</a></li><li data-type='method'><a href="RESTv2.html#trades">trades</a></li><li data-type='method'><a href="RESTv2.html#transfer">transfer</a></li><li data-type='method'><a href="RESTv2.html#updateOrder">updateOrder</a></li><li data-type='method'><a href="RESTv2.html#updateOrderMulti">updateOrderMulti</a></li><li data-type='method'><a href="RESTv2.html#updateSettings">updateSettings</a></li><li data-type='method'><a href="RESTv2.html#userInfo">userInfo</a></li><li data-type='method'><a href="RESTv2.html#usesAgent">usesAgent</a></li><li data-type='method'><a href="RESTv2.html#wallets">wallets</a></li><li data-type='method'><a href="RESTv2.html#walletsHistory">walletsHistory</a></li><li data-type='method'><a href="RESTv2.html#withdraw">withdraw</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">rest2.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

const debug = require('debug')('bfx:rest2')
const rp = require('request-promise')
const Promise = require('bluebird')
const _isEmpty = require('lodash/isEmpty')
const _isString = require('lodash/isString')
const _isFunction = require('lodash/isFunction')
const _pick = require('lodash/pick')
const _omitBy = require('lodash/omitBy')
const _isNil = require('lodash/isNil')
const _isInteger = require('lodash/isInteger')
const _flatten = require('lodash/flatten')
const { URLSearchParams } = require('url')
const { genAuthSig, nonce, isClass } = require('bfx-api-node-util')
const {
  FundingCredit,
  FundingLoan,
  FundingOffer,
  FundingTrade,
  MarginInfo,
  Order,
  Position,
  Trade,
  PublicTrade,
  TradingTicker,
  TradingTickerHist,
  FundingTicker,
  FundingTickerHist,
  Wallet,
  WalletHist,
  Alert,
  Candle,
  Movement,
  LedgerEntry,
  Liquidations,
  UserInfo,
  Currency,
  StatusMessagesDeriv,
  Notification,
  Login,
  ChangeLog,
  PublicPulseProfile,
  PulseMessage,
  Invoice,
  SymbolDetails,
  TransactionFee,
  AccountSummary,
  AuthPermission,
  CoreSettings
} = require('bfx-api-node-models')

const BASE_TIMEOUT = 15000
const API_URL = 'https://api.bitfinex.com'

/**
 * Parses response into notification object
 *
 * @param {object} data - notification
 * @returns {Notification} n
 * @private
 */
function _takeResNotify (data) {
  const notification = new Notification(data)
  return notification
}

/**
 * Communicates with v2 of the Bitfinex HTTP API
 */
class RESTv2 {
  /**
   * Instantiate a new REST v2 transport.
   *
   * @param {object} opts - options
   * @param {string} [opts.affCode] - affiliate code to be applied to all orders
   * @param {string} [opts.apiKey] - API key
   * @param {string} [opts.apiSecret] - API secret
   * @param {string} [opts.authToken] - optional auth option
   * @param {string} [opts.url] - endpoint URL
   * @param {boolean} [opts.transform] - default false
   * @param {object} [opts.agent] - optional node agent for connection (proxy)
   * @param {number} [opts.timeout] - default 15000
   */
  constructor (opts = {
    affCode: null,
    apiKey: '',
    apiSecret: '',
    authToken: '',
    company: '',
    url: API_URL,
    transform: false,
    agent: null,
    timeout: BASE_TIMEOUT
  }) {
    this._checkOpts(opts)

    this._url = opts.url || API_URL
    this._apiKey = opts.apiKey || ''
    this._apiSecret = opts.apiSecret || ''
    this._authToken = opts.authToken || ''
    this._company = opts.company || ''
    this._transform = !!opts.transform
    this._agent = opts.agent
    this._affCode = opts.affCode
    this._timeout = _isInteger(opts.timeout)
      ? opts.timeout
      : BASE_TIMEOUT
  }

  /**
   * Check constructor options
   *
   * @param {object} opts - constructor options
   * @throws {Error} - throws an Error if check is not passed
   * @returns {undefined}
   * @private
   */
  _checkOpts (opts) {
    if (
      !_isNil(opts.timeout) &amp;&amp;
      !_isInteger(opts.timeout)
    ) {
      throw new Error('ERR_TIMEOUT_DATA_TYPE_ERROR')
    }
  }

  /**
   * @returns {boolean} url
   */
  getURL () {
    return this._url
  }

  /**
   * @returns {boolean} usesAgent
   */
  usesAgent () {
    return !!this._agent
  }

  /**
   * @param {string} path - path
   * @param {object} payload - payload
   * @param {Function} [cb] - legacy callback
   * @param {object|Function} transformer - model class or function
   * @returns {Promise} p
   * @private
   */
  _makeAuthRequest (path, payload = {}, cb, transformer) {
    if ((!this._apiKey || !this._apiSecret) &amp;&amp; !this._authToken) {
      const e = new Error('missing api key or secret')
      return this._cb(e, null, cb)
    }

    const url = `${this._url}/v2${path}`
    const n = nonce()
    const sanitizedPayload = _omitBy(payload, _isNil)
    const keys = () => {
      const sigPayload = `/api/v2${path}${n}${JSON.stringify(sanitizedPayload)}`
      const { sig } = genAuthSig(this._apiSecret, sigPayload)
      return { 'bfx-apikey': this._apiKey, 'bfx-signature': sig }
    }
    const auth = (this._authToken)
      ? { 'bfx-token': this._authToken }
      : keys()

    debug('POST %s', url)

    return rp({
      url,
      method: 'POST',
      timeout: this._timeout,
      headers: {
        'bfx-nonce': n,
        ...auth
      },
      agent: this._agent,
      body: sanitizedPayload,
      json: true
    }).then((data) => {
      return this._response(data, transformer, cb)
    })
  }

  /**
   * @param {string} path - path
   * @param {Function} [cb] - legacy callback
   * @param {object|Function} transformer - model class or function
   * @returns {Promise} p
   * @private
   */
  _makePublicRequest (path, cb, transformer) {
    const url = `${this._url}/v2${path}`

    debug('GET %s', url)

    return rp({
      url,
      method: 'GET',
      timeout: this._timeout,
      agent: this._agent,
      json: true
    }).then((data) => {
      return this._response(data, transformer, cb)
    })
  }

  /**
   * @param {string} path - path
   * @param {object} body - payload
   * @param {Function} [cb] - legacy callback
   * @param {object|Function} transformer - model class or function
   * @returns {Promise} p
   * @private
   */
  _makePublicPostRequest (path, body, cb, transformer) {
    const url = `${this._url}/v2${path}`

    debug('POST %s', url)

    return rp({
      url,
      method: 'POST',
      timeout: this._timeout,
      agent: this._agent,
      json: true,
      body
    }).then((data) => {
      return this._response(data, transformer, cb)
    })
  }

  /**
   * @param {object} data
   * @param {object|Function} transformer - model class or function
   * @returns {object|object[]} finalData
   * @private
   */

  _doTransform (data, transformer) {
    if (isClass(transformer)) {
      return this._classTransform(data, transformer)
    } else if (_isFunction(transformer)) {
      return transformer(data)
    } else {
      return data
    }
  }

  /**
   * @param {object} data - data
   * @param {object} ModelClass - class
   * @returns {object|object[]} finalData
   * @private
   */
  _classTransform (data, ModelClass) {
    if (!data || data.length === 0) return []
    if (!ModelClass || !this._transform) return data

    if (Array.isArray(data[0])) {
      return data.map(row => new ModelClass(row, this))
    }

    return new ModelClass(data, this)
  }

  /**
   * @param {object} data - data
   * @param {object|Function} transformer - model class or function
   * @param {Function} [cb] - legacy callback
   * @returns {object|object[]} finalData
   * @private
   */
  _response (data, transformer, cb) {
    try {
      const res = (this._transform)
        ? this._doTransform(data, transformer)
        : data

      return this._cb(null, res, cb)
    } catch (e) {
      return this._cb(e, null, cb)
    }
  }

  /**
   * @param {Error} err - error
   * @param {object} res -resposne
   * @param {Function} [cb] - legacy callback
   * @returns {Promise} p
   * @private
   */
  _cb (err, res, cb) {
    return new Promise((resolve, reject) => {
      const _isCbFunc = _isFunction(cb)
      if (err) {
        if (err.error &amp;&amp; err.error[1] === 10114) {
          err.message += ' see https://github.com/bitfinexcom/bitfinex-api-node/blob/master/README.md#nonce-too-small for help'
        }

        if (_isCbFunc) cb(err)
        return reject(err)
      } else {
        if (_isCbFunc) cb(null, res)
        return resolve(res)
      }
    })
  }

  /**
   * @param {Array[]} data order matters
   * @returns {Array[]} merged arr of currencies and names sorted with no pairs repeated adding pool and explorer to each
   * @private
   */
  _genCurrencyList (data) {
    if (!Array.isArray(data) || data.length !== 6) {
      return data
    }

    const transformArrToObj = (arr) => {
      const obj = {}
      arr.forEach((c) => {
        if (!Array.isArray(c)) {
          obj[c] = c
        } else if (c.length > 1) {
          obj[c[0]] = c[1]
        }
      })
      return obj
    }

    const listedCurr = transformArrToObj(data[0])
    const mapedCurrSym = transformArrToObj(data[1])
    const mapedCurrLabel = transformArrToObj(data[2])
    const pool = transformArrToObj(data[3])
    const explorer = transformArrToObj(data[4])
    const walletFx = transformArrToObj(data[5])

    const allCurrObj = {
      ...listedCurr,
      ...mapedCurrSym,
      ...mapedCurrLabel
    }

    // Assigne explores of pool to currencies
    Object.keys(pool).forEach((key) => {
      if (!explorer[key]) {
        if (explorer[pool[key]]) {
          explorer[key] = explorer[pool[key]]
        }
      }
    })

    const allCurArr = []
    Object.keys(allCurrObj).forEach((key) => {
      const cPool = pool[key] || null
      const cExpl = explorer[key] || []
      const cName = allCurrObj[key]
      const cSymbol = mapedCurrSym[key] || key
      const cWfx = walletFx[key] || []
      allCurArr.push([key, cName, cPool, cExpl, cSymbol, cWfx])
    })

    return allCurArr
  }

  /**
   * @param {object} params        - parameters
   * @param {string} params.symbol - i.e. tBTCUSD
   * @param {string} params.prec   - i.e. P0
   * @param {Function} [cb]        - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-public-books
   */
  orderBook (params, cb = null) {
    const { symbol, prec } = params
    return this._makePublicRequest(`/book/${symbol}/${prec}`, cb)
  }

  /**
   * @param {object} params          - parameters
   * @param {string} params.nickname - i.e. Bitfinex
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-public-pulse-profile
   */
  publicPulseProfile (params, cb = null) {
    const { nickname } = params
    return this._makePublicRequest(`/pulse/profile/${nickname}`, cb, PublicPulseProfile)
  }

  /**
   * @param {object} params        - parameters
   * @param {string} params.limit  - Number of records (Max: 100)
   * @param {string} params.end    - Millisecond start time
   * @param {Function} [cb]        - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-public-pulse-hist
   */
  publicPulseHistory (params, cb = null) {
    const { limit, end } = params
    return this._makePublicRequest(`/pulse/hist?limit=${limit}&amp;end=${end}`, cb, PulseMessage)
  }

  /**
   * @param {object} params              - parameters
   * @param {string} params.symbol       - Symbol you want information about i.e tBTCUSD, fUSD
   * @param {string} params.amount       - Amount. Positive for buy, negative for sell (ex. "1.123")
   * @param {string} [params.period]     - (optional) Maximum period for Margin Funding
   * @param {string} [params.rate_limit] - Limit rate/price (ex. "1000.5")
   * @param {Function} [cb]              - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-public-calc-market-average-price
   */
  marketAveragePrice (params, cb = null) {
    const usp = new URLSearchParams(params)
    return this._makePublicPostRequest(`/calc/trade/avg?${usp.toString()}`, {}, cb)
  }

  /**
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-public-platform-status
   */
  status (params = {}, cb = null) {
    return this._makePublicRequest('/platform/status', cb)
  }

  /**
   * @param {object} [params]        - parameters
   * @param {string} [params.type]   - type
   * @param {string[]} [params.keys] - keys
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#status
   */
  statusMessages (params = {}, cb = null) {
    const { type = 'deriv', keys = ['ALL'] } = params
    const url = `/status/${type}?keys=${keys.join(',')}`
    const transformer = (type === 'deriv') ? StatusMessagesDeriv : null

    return this._makePublicRequest(url, cb, transformer)
  }

  /**
   * @param {object} params        - parameters
   * @param {string} params.symbol - symbol
   * @param {Function} [cb]        - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-public-ticker
   */
  ticker (params, cb = null) {
    const { symbol } = params
    const transformer = (data) => {
      const ticker = [symbol, ...data]
      return (symbol[0] === 't')
        ? new TradingTicker(ticker)
        : new FundingTicker(ticker)
    }

    return this._makePublicRequest(`/ticker/${symbol}`, cb, transformer)
  }

  /**
   * @param {object} [params]           - parameters
   * @param {string[]} [params.symbols] - symbols
   * @param {Function} [cb]             - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-public-tickers
   */
  tickers (params = {}, cb = null) {
    const { symbols = [] } = params
    const transformer = (data) => {
      return data.map(ticker => (
        (ticker[0] || '')[0] === 't'
          ? new TradingTicker(ticker)
          : new FundingTicker(ticker)
      ))
    }

    const url = `/tickers?symbols=${symbols.length ? symbols.join(',') : 'ALL'}`
    return this._makePublicRequest(url, cb, transformer)
  }

  /**
   * @param {object} [params]           - parameters
   * @param {string[]} [params.symbols] - symbols
   * @param {number} [params.start]     - query start timestamp
   * @param {number} [params.end]       - query end timestamp
   * @param {number} [params.limit]     - query limit
   * @param {Function} [cb]             - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-public-tickers-history
   */
  tickersHistory (params = {}, cb = null) {
    const { symbols = [], start, end, limit = 250 } = params
    const transformer = (data) => {
      return data.map(ticker => (
        (ticker[0] || '')[0] === 't'
          ? new TradingTickerHist(ticker)
          : new FundingTickerHist(ticker)
      ))
    }

    const s = (start) ? `&amp;start=${start}` : ''
    const e = (end) ? `&amp;end=${end}` : ''
    const query = `?symbols=${symbols.length ? symbols.join(',') : 'ALL'}${s}${e}&amp;limit=${limit}`
    const url = `/tickers/hist${query}`

    return this._makePublicRequest(url, cb, transformer)
  }

  /**
   * @param {object} params         - parameters
   * @param {string} params.key     - key
   * @param {string} params.context - context
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-public-stats
   */
  stats (params, cb = null) {
    const { key, context } = params
    return this._makePublicRequest(`/stats1/${key}/${context}`, cb)
  }

  /**
   * @param {object} params               - parameters
   * @param {string} params.timeframe     - 1m, 5m, 15m, 30m, 1h, 3h, 6h, 12h, 1D, 7D, 14D, 1M
   * @param {string} params.symbol        - symbol
   * @param {string} params.section       - hist, last
   * @param {object} [params.query]       - query params
   * @param {number} [params.query.sort]  - query sort param
   * @param {number} [params.query.start] - query sort param
   * @param {number} [params.query.end]   - query sort param
   * @param {number} [params.query.limit] - query sort param
   * @param {Function} [cb]               - legacy callback
   * @returns {Promise} p
   * @see http://docs.bitfinex.com/v2/reference#rest-public-candles
   */
  candles (params, cb = null) {
    const { timeframe, symbol, section, query = {} } = params
    let url = `/candles/trade:${timeframe}:${symbol}/${section}`

    if (Object.keys(query).length > 0) {
      url += `?${new URLSearchParams(query).toString()}`
    }

    return this._makePublicRequest(url, cb, Candle)
  }

  /**
   * Query configuration information
   *
   * @param {object} [params]        - parameters
   * @param {string[]} [params.keys] - keys
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   */
  conf (params = {}, cb = null) {
    const { keys = [] } = params
    if (_isEmpty(keys)) {
      return this._response([], null, cb)
    }

    const url = `/conf/${keys.join(',')}`
    return this._makePublicRequest(url, cb)
  }

  /**
   * Get a list of valid currencies ids, full names, pool and explorer
   *
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-public-currencies
   */
  async currencies (params = {}, cb = null) {
    const suffix = (this._company) ? ':' + this._company : ''
    const url = `/conf/${[
      `pub:list:currency${suffix}`,
      `pub:map:currency:sym${suffix}`,
      `pub:map:currency:label${suffix}`,
      `pub:map:currency:pool${suffix}`,
      `pub:map:currency:explorer${suffix}`,
      `pub:map:currency:wfx${suffix}`
    ].join(',')}`

    return this._makePublicRequest(url, cb, (data) => {
      const res = this._genCurrencyList(data)
      return this._doTransform(res, Currency)
    })
  }

  /**
   * @param {object} params      - parameters
   * @param {string} params.type - type
   * @param {Function} [cb]      - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-alert-list
   */
  alertList (params, cb = null) {
    const { type } = params
    return this._makeAuthRequest('/auth/r/alerts', { type }, cb, Alert)
  }

  /**
   * @param {object} params        - parameters
   * @param {string} params.type   - type
   * @param {string} params.symbol - symbol
   * @param {number} params.price  - price
   * @param {Function} [cb] - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-alert-set
   */
  alertSet (params, cb = null) {
    const { type, symbol, price } = params
    return this._makeAuthRequest('/auth/w/alert/set', { type, symbol, price }, cb, Alert)
  }

  /**
   * @param {object} params        - parameters
   * @param {string} params.symbol - symbol
   * @param {number} params.price  - price
   * @param {Function} [cb]        - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-alert-delete
   */
  alertDelete (params, cb = null) {
    const { symbol, price } = params
    return this._makeAuthRequest('/auth/w/alert/del', { symbol, price }, cb)
  }

  /**
   * @param {object} params         - parameters
   * @param {string} params.symbol  - symbol
   * @param {number} [params.start] - query start
   * @param {number} [params.end]   - query end
   * @param {number} [params.limit] - query limit
   * @param {number} [params.sort]  - if 1, sorts results oldest first
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-public-trades
   */
  trades (params, cb = null) {
    const { symbol, start, end, limit, sort } = params
    const query = {}

    Object.assign(query, _omitBy({ start, end, limit, sort }, _isNil))

    let url = `/trades/${symbol}/hist`

    if (Object.keys(query).length > 0) {
      url += `?${new URLSearchParams(query).toString()}`
    }

    return this._makePublicRequest(url, cb, PublicTrade)
  }

  /**
   * @param {object} [params]       - parameters
   * @param {number} [params.start] - query start
   * @param {number} [params.end]   - query end
   * @param {number} [params.limit] - query limit
   * @param {number} [params.sort]  - if 1, sorts results oldest first
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-public-liquidations
   */
  liquidations (params = {}, cb = null) {
    const { start, end, limit, sort } = params
    const query = {}

    Object.assign(query, _omitBy({ start, end, limit, sort }, _isNil))

    let url = '/liquidations/hist'

    if (Object.keys(query).length > 0) {
      url += `?${new URLSearchParams(query).toString()}`
    }

    return this._makePublicRequest(url, cb, Liquidations)
  }

  /**
   * @param {object} [params]        - parameters
   * @param {string} [params.symbol] - optional, omit/leave empty for all
   * @param {number} [params.start]  - query start
   * @param {number} [params.end]    - query end
   * @param {number} [params.limit]  - query limit
   * @param {number} [params.sort]   - if 1, sorts results oldest first
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-trades-hist
   */
  accountTrades (params = {}, cb = null) {
    const { symbol, start, end, limit, sort } = params
    const url = !_isEmpty(symbol)
      ? `/auth/r/trades/${symbol}/hist`
      : '/auth/r/trades/hist'

    return this._makeAuthRequest(url, {
      start, end, limit, sort
    }, cb, Trade)
  }

  /**
   * @param {object} [params]       - parameters
   * @param {number} [params.start] - query start
   * @param {number} [params.end]   - query end
   * @param {number} [params.limit] - query limit
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-logins-hist
   */
  logins (params = {}, cb = null) {
    const url = '/auth/r/logins/hist'
    const { start, end, limit } = params

    return this._makeAuthRequest(url, {
      start, end, limit
    }, cb, Login)
  }

  /**
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-wallets
   */
  wallets (params = {}, cb = null) {
    return this._makeAuthRequest('/auth/r/wallets', params, cb, Wallet)
  }

  /**
   * @param {object} [params]          - parameters
   * @param {number} [params.end]      - query end
   * @param {string} [params.currency] - currency
   * @param {Function} [cb]            - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-wallets-hist
   */
  walletsHistory (params = {}, cb = null) {
    return this._makeAuthRequest('/auth/r/wallets/hist', params, cb, WalletHist)
  }

  /**
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-auth-info-user
   */
  userInfo (params = {}, cb = null) {
    return this._makeAuthRequest('/auth/r/info/user', params, cb, UserInfo)
  }

  /**
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-orders
   */
  activeOrders (params = {}, cb = null) {
    return this._makeAuthRequest('/auth/r/orders', params, cb, Order)
  }

  /**
   * @param {object} params    - parameters
   * @param {Array} params.ids - order ids
   * @param {Function} cb      - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-orders
   */
  activeOrdersWithIds (params, cb = null) {
    const { ids } = params
    const url = '/auth/r/orders'
    return this._makeAuthRequest(url, { id: ids }, cb, Order)
  }

  /**
   * @param {object} [params]           - parameters
   * @param {string} [params.ccy]       - i.e. ETH
   * @param {number} [params.start]     - query start
   * @param {number} [params.end]       - query end
   * @param {number} [params.limit]     - query limit, default 25
   * @param {Array&lt;number>} [params.id] - Optional array of deposit/withdrawal ids
   * @param {Function} [cb]             - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#movements
   */
  movements (params = {}, cb = null) {
    const { ccy, start, end, limit = 25, id = [] } = params
    const url = ccy
      ? `/auth/r/movements/${ccy}/hist`
      : '/auth/r/movements/hist'

    return this._makeAuthRequest(url, { start, end, limit, id }, cb, Movement)
  }

  /**
   * @param {object} params                - parameters
   * @param {object|string} params.filters - filters
   * @param {number} [params.start]        - query start
   * @param {number} [params.end]          - query end
   * @param {number} [params.limit]        - default 25
   * @param {Function} [cb]                - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#ledgers
   */
  ledgers (params, cb = null) {
    const { filters, start, end, limit = 25 } = params
    const parseFilters = (sent) => {
      if (_isString(sent)) return { ccy: sent }
      return sent || {}
    }

    const { ccy, category } = parseFilters(filters)
    const url = ccy
      ? `/auth/r/ledgers/${ccy}/hist`
      : '/auth/r/ledgers/hist'

    return this._makeAuthRequest(url, {
      start, end, limit, category
    }, cb, LedgerEntry)
  }

  /**
   * @param {object} [params]        - parameters
   * @param {string} [params.symbol] - optional, omit/leave empty for all
   * @param {number} [params.start]  - query start
   * @param {number} [params.end]    - query end
   * @param {number} [params.limit]  - query limit
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-auth-orders-history
   */
  orderHistory (params = {}, cb = null) {
    const { symbol, start, end, limit } = params
    const url = !_isEmpty(symbol)
      ? `/auth/r/orders/${symbol}/hist`
      : '/auth/r/orders/hist'

    return this._makeAuthRequest(url, {
      start, end, limit
    }, cb, Order)
  }

  /**
   * @param {object} params    - parameters
   * @param {Array} params.ids - order ids
   * @param {Function} [cb]      - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-auth-orders-history
   */
  orderHistoryWithIds (params, cb = null) {
    const { ids } = params
    const url = '/auth/r/orders/hist'
    return this._makeAuthRequest(url, { id: ids }, cb, Order)
  }

  /**
   * @param {object} params           - parameters
   * @param {string} params.symbol    - symbol
   * @param {number} [params.start]   - query start
   * @param {number} [params.end]     - query end
   * @param {number} [params.limit]   - query limit
   * @param {number} params.orderId   - order ID
   * @param {Function} [cb]           - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-order-trades
   */
  orderTrades (params, cb = null) {
    const { symbol, start, end, limit, orderId } = params
    return this._makeAuthRequest(`/auth/r/order/${symbol}:${orderId}/trades`, {
      start, end, limit
    }, cb, Trade)
  }

  /**
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-positions
   */
  positions (params = {}, cb = null) {
    return this._makeAuthRequest('/auth/r/positions', params, cb, Position)
  }

  /**
   * @param {object} [params]       - parameters
   * @param {number} [params.start] - query start
   * @param {number} [params.end]   - query end
   * @param {number} [params.limit] - query limit
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-positions-history
   */
  positionsHistory (params = {}, cb = null) {
    const { start, end, limit = 50 } = params
    return this._makeAuthRequest('/auth/r/positions/hist', {
      start, end, limit
    }, cb, Position)
  }

  /**
   * @param {object} [params]       - parameters
   * @param {number[]} [params.id]  - ids of positions to audit
   * @param {number} [params.start] - query start
   * @param {number} [params.end]   - query end
   * @param {number} [params.limit] - query limit
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-positions-audit
   */
  positionsAudit (params = {}, cb = null) {
    const { id, start, end, limit = 250 } = params
    return this._makeAuthRequest('/auth/r/positions/audit', {
      id, start, end, limit
    }, cb, Position)
  }

  /**
   * @param {object} [params]       - parameters
   * @param {number} [params.start] - query start
   * @param {number} [params.end]   - query end
   * @param {number} [params.limit] - query limit
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-positions-snap
   */
  positionsSnapshot (params = {}, cb = null) {
    const { start, end, limit = 50 } = params
    return this._makeAuthRequest('/auth/r/positions/snap', {
      start, end, limit
    }, cb, Position)
  }

  /**
   * @param {object} params        - parameters
   * @param {string} params.symbol - symbol
   * @param {Function} [cb]        - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-funding-offers
   */
  fundingOffers (params, cb = null) {
    const { symbol } = params
    return this._makeAuthRequest(`/auth/r/funding/offers/${symbol}`, {}, cb, FundingOffer)
  }

  /**
   * @param {object} params          - parameters
   * @param {string} [params.symbol] - omit/leave empty for all
   * @param {number} [params.start]  - query start
   * @param {number} [params.end]    - query end
   * @param {number} [params.limit]  - query limit
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-funding-offers-hist
   */
  fundingOfferHistory (params, cb = null) {
    const { symbol = '', start, end, limit } = params
    const url = !_isEmpty(symbol)
      ? `/auth/r/funding/offers/${symbol}/hist`
      : '/auth/r/funding/offers/hist'
    return this._makeAuthRequest(url, {
      start, end, limit
    }, cb, FundingOffer)
  }

  /**
   * @param {object} params        - parameters
   * @param {string} params.symbol - symbol
   * @param {Function} [cb]        - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-funding-loans
   */
  fundingLoans (params, cb = null) {
    const { symbol } = params
    return this._makeAuthRequest(`/auth/r/funding/loans/${symbol}`, {}, cb, FundingLoan)
  }

  /**
   * @param {object} params          - parameters
   * @param {string} [params.symbol] - omit/leave empty for all
   * @param {number} [params.start]  - query start
   * @param {number} [params.end]    - query end
   * @param {number} [params.limit]  - query limit
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-funding-loans-hist
   */
  fundingLoanHistory (params, cb = null) {
    const { symbol = '', start, end, limit } = params
    const url = !_isEmpty(symbol)
      ? `/auth/r/funding/loans/${symbol}/hist`
      : '/auth/r/funding/loans/hist'
    return this._makeAuthRequest(url, {
      start, end, limit
    }, cb, FundingLoan)
  }

  /**
   * @param {object} params        - parameters
   * @param {string} params.symbol - symbol
   * @param {Function} [cb]        - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-funding-credits
   */
  fundingCredits (params, cb = null) {
    const { symbol } = params
    return this._makeAuthRequest(`/auth/r/funding/credits/${symbol}`, {}, cb, FundingCredit)
  }

  /**
   * @param {object} params          - parameters
   * @param {string} [params.symbol] - omit/leave empty for all
   * @param {number} [params.start]  - query start
   * @param {number} [params.end]    - query end
   * @param {number} [params.limit]  - query limit
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-funding-credits-hist
   */
  fundingCreditHistory (params, cb = null) {
    const { symbol = '', start, end, limit } = params
    const url = !_isEmpty(symbol)
      ? `/auth/r/funding/credits/${symbol}/hist`
      : '/auth/r/funding/credits/hist'
    return this._makeAuthRequest(url, {
      start, end, limit
    }, cb, FundingCredit)
  }

  /**
   * @param {object} params          - parameters
   * @param {string} [params.symbol] - optional, omit/leave empty for all
   * @param {number} [params.start]  - query start
   * @param {number} [params.end]    - query end
   * @param {number} [params.limit]  - query limit
   * @param {Function} [cb] - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-funding-trades-hist
   */
  fundingTrades (params, cb = null) {
    const { symbol = '', start, end, limit } = params
    const url = !_isEmpty(symbol)
      ? `/auth/r/funding/trades/${symbol}/hist`
      : '/auth/r/funding/trades/hist'

    return this._makeAuthRequest(url, {
      start, end, limit
    }, cb, FundingTrade)
  }

  /**
   * @param {object} [params]     - parameters
   * @param {string} [params.key] - key
   * @param {Function} [cb]       - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-info-margin
   */
  marginInfo (params = {}, cb = null) {
    const { key = 'base' } = params
    return this._makeAuthRequest(`/auth/r/info/margin/${key}`, {}, cb, MarginInfo)
  }

  /**
   * @param {object} [params]       - parameters
   * @param {number} [params.start] - query start
   * @param {number} [params.end]   - query end
   * @param {number} [params.limit] - query limit
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-audit-hist
   */
  changeLogs (params = {}, cb = null) {
    const { start, end, limit } = params
    return this._makeAuthRequest('/auth/r/audit/hist', {
      start, end, limit
    }, cb, ChangeLog)
  }

  /**
   * @param {object} params     - parameters
   * @param {string} params.key - key
   * @param {Function} [cb]     - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-info-funding
   */
  fundingInfo (params, cb = null) {
    const { key } = params
    return this._makeAuthRequest(`/auth/r/info/funding/${key}`, {}, cb)
  }

  /**
   * @param {object} params      - parameters
   * @param {string} params.type - Specify the funding type ('credit' or 'loan')
   * @param {string} params.id   - The loan or credit id
   * @param {Function} [cb]      - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-auth-keep-funding
   */
  keepFunding (params, cb = null) {
    const { type, id } = params
    return this._makeAuthRequest('/auth/w/funding/keep', { type, id }, cb)
      .then(_takeResNotify)
  }

  /**
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-performance
   */
  performance (params = {}, cb = null) {
    return this._makeAuthRequest('/auth/r/stats/perf:1D/hist', params, cb)
  }

  /**
   * @param {object} params        - parameters
   * @param {string} params.symbol - symbol
   * @param {string} params.type   - type
   * @param {string} [params.dir]  - dir
   * @param {number} [params.rate] - rate
   * @param {string} [params.lev]  - lev
   * @param {Function} [cb]        - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference/rest-auth-calc-order-avail
   */
  calcAvailableBalance (params, cb = null) {
    return this._makeAuthRequest('/auth/calc/order/avail', params, cb)
  }

  /**
   * Get a list of valid symbol names
   *
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-public-symbols
   */
  symbols (params = {}, cb = null) {
    const url = '/conf/pub:list:pair:exchange'
    return this._makePublicRequest(url, cb, (data) => {
      return data &amp;&amp; data[0]
    })
  }

  /**
   * Get a list of inactive symbol names
   *
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-public-symbols
   */
  inactiveSymbols (params = {}, cb = null) {
    const url = '/conf/pub:list:pair:exchange:inactive'
    return this._makePublicRequest(url, cb, (data) => {
      return data &amp;&amp; data[0]
    })
  }

  /**
   * Get a list of valid symbol names
   *
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-public-futures
   */
  futures (params = {}, cb = null) {
    const url = '/conf/pub:list:pair:futures'
    return this._makePublicRequest(url, cb, (data) => {
      return data &amp;&amp; data[0]
    })
  }

  /**
   * Changes the collateral value of an active derivatives position for a certain pair.
   *
   * @param {object} params            - parameters
   * @param {string} params.symbol     - symbol
   * @param {number} params.collateral - collateral
   * @param {Function} [cb]            - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/v2/reference#rest-auth-deriv-pos-collateral-set
   */
  derivsPositionCollateralSet (params, cb = null) {
    const { symbol, collateral } = params
    const url = '/auth/w/deriv/collateral/set'
    const isRequestValid = (res) => !!(res &amp;&amp; res[0] &amp;&amp; res[0][0])
    return this._makeAuthRequest(url, {
      symbol, collateral
    }, cb, isRequestValid)
  }

  /**
   * Get a list of valid symbol names and details
   *
   * @param {object} [params]                     - parameters
   * @param {boolean} [params.includeFuturePairs] - optional, default value is true
   * @param {Function} [cb]                       - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-public-conf
   */
  symbolDetails (params = {}, cb = null) {
    const { includeFuturePairs = true } = params
    const url = `/conf/pub:info:pair${includeFuturePairs ? ',pub:info:pair:futures' : ''}`

    const transformer = (data) => {
      return data &amp;&amp; this._classTransform(_flatten(data), SymbolDetails)
    }

    return this._makePublicRequest(url, cb, transformer)
  }

  /**
   * Request account withdrawl fees
   *
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   */
  accountFees (params = {}, cb = null) {
    const url = '/conf/pub:map:currency:tx:fee'
    const transformer = (data) => {
      return data &amp;&amp; this._classTransform(data[0], TransactionFee)
    }

    return this._makePublicRequest(url, cb, transformer)
  }

  /**
   * Returns a 30-day summary of your trading volume and return on margin
   * funding.
   *
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-auth-summary
   */
  accountSummary (params = {}, cb = null) {
    const url = '/auth/r/summary'
    return this._makeAuthRequest(url, params, cb, AccountSummary)
  }

  /**
   * Fetch the permissions of the key or token being used to generate this request
   *
   * @param {object} [params] - parameters
   * @param {Function} [cb]   - legacy callback
   * @returns {Promise} p
   */
  keyPermissions (params = {}, cb = null) {
    return this._makeAuthRequest('/auth/r/permissions', params, cb, AuthPermission)
  }

  /**
   * @param {object} params             - parameters
   * @param {number} params.position_id - position ID
   * @param {Function} [cb]             - legacy callback
   * @returns {Promise} p
   *
   * @see https://docs.bitfinex.com/reference#rest-auth-submit-order
   */
  closePosition (params, cb = null) {
    return this.positions()
      .then(res => {
        if (!this._transform) {
          res = res.map(row => new Position(row, this))
        }

        const position = res.find(p => p.id === params.position_id &amp;&amp; p.status === 'ACTIVE')
        if (!position) throw new Error('position not found')

        return position
      })
      .then(position => {
        const order = new Order({
          type: Order.type.MARKET,
          symbol: position.symbol,
          amount: position.amount * -1,
          flags: Order.flags.POS_CLOSE
        })

        return this.submitOrder({ order })
      })
      .then(res => this._cb(null, res, cb))
      .catch(err => this._cb(err, null, cb))
  }

  /**
   * @param {object} params          - parameters
   * @param {object} params.settings - key:value map
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   */
  updateSettings (params, cb = null) {
    const { settings } = params
    return this._makeAuthRequest('/auth/w/settings/set', {
      settings
    }, cb)
  }

  /**
   * @param {object} params        - parameters
   * @param {string[]} params.keys - keys
   * @param {Function} [cb]        - legacy callback
   * @returns {Promise} p
   */
  deleteSettings (params, cb = null) {
    const { keys } = params
    return this._makeAuthRequest('/auth/w/settings/del', { keys }, cb)
  }

  /**
   * @param {object} params        - parameters
   * @param {string[]} params.keys - keys
   * @param {Function} [cb]        - legacy callback
   * @returns {Promise} p
   */
  getSettings (params, cb = null) {
    const { keys } = params
    return this._makeAuthRequest('/auth/r/settings', { keys }, cb)
  }

  /**
   * @param {object} params        - parameters
   * @param {string[]} params.keys - keys
   * @param {Function} [cb]        - legacy callback
   * @returns {Promise} p
   */
  getCoreSettings (params, cb = null) {
    const { keys } = params
    return this._makeAuthRequest('/auth/r/settings/core', { keys }, cb, CoreSettings)
  }

  /**
   * @param {object} params      - parameters
   * @param {string} params.ccy1 - i.e. BTC
   * @param {string} params.ccy2 - i.e. USD
   * @param {Function} [cb]      - legacy callback
   * @returns {Promise} p
   */
  async exchangeRate (params, cb = null) {
    const { ccy1, ccy2 } = params
    const res = await this._makePublicPostRequest('/calc/fx', { ccy1, ccy2 })
    return this._response(res[0], null, cb)
  }

  /**
   * @param {object} params                    - parameters
   * @param {string} params.scope              - scope of the token
   * @param {number} [params.ttl]              - time-to-live in seconds
   * @param {string[]} [params.caps]           - token caps/permissions
   * @param {boolean} [params.writePermission] - token write permission
   * @param {string} [params._cust_ip]         - user ip address
   * @param {Function} [cb]                    - legacy callback
   * @returns {Promise} p
   */
  generateToken (params, cb = null) {
    let opts = _pick(params || {}, ['ttl', 'scope', 'caps', 'writePermission', '_cust_ip'])
    opts = _omitBy(params, _isNil)
    if (!opts.scope) return this._cb(new Error('scope param is required'), null, cb)

    return this._makeAuthRequest('/auth/w/token', opts, cb)
  }

  /**
   * @param {object} params           - parameters
   * @param {string} params.authToken - target that will be invalidated
   * @param {Function} [cb]           - legacy callback
   * @returns {Promise} p
   */
  invalidateAuthToken (params, cb = null) {
    const { authToken } = params
    return this._makeAuthRequest('/auth/w/token/del', { token: authToken }, cb)
  }

  /**
   * Submit new order
   *
   * @param {object} params      - parameters
   * @param {Order} params.order - order model instance
   * @param {Function} [cb]      - legacy callback
   * @returns {Promise} p
   */
  submitOrder (params, cb = null) {
    const { order } = params
    const packet = order.toNewOrderPacket()

    if (this._affCode) {
      if (!packet.meta) {
        packet.meta = {}
      }

      packet.meta.aff_code = packet.meta.aff_code || this._affCode // eslint-disable-line
    }

    return this._makeAuthRequest('/auth/w/order/submit', packet, cb)
      .then((res) => {
        // 2 orders can be returned if OCO was used. But due to the interface
        // we can only return one. User should use getOrders instead
        const orders = _takeResNotify(res).notifyInfo || []
        return orders[0] || []
      })
  }

  /**
   * Update existing order
   *
   * @param {object} params - changes
   * @param {Function} [cb] - legacy callback
   * @returns {Promise} p
   */
  updateOrder (params, cb = null) {
    return this._makeAuthRequest('/auth/w/order/update', params, cb)
      .then(_takeResNotify)
  }

  /**
   * Cancel existing order
   *
   * @param {object} params    - parameters
   * @param {number} params.id - order id
   * @param {Function} [cb]    - legacy callback
   * @returns {Promise} p
   */
  cancelOrder (params, cb = null) {
    const { id } = params
    return this._makeAuthRequest('/auth/w/order/cancel', { id }, cb)
      .then(_takeResNotify)
  }

  /**
   * Cancel existing order using the cID
   *
   * @param {object} params      - parameters
   * @param {number} params.cid  - cid
   * @param {string} params.date - Date of order YYYY-MM-DD
   * @param {Method} cb          - legacy callback
   * @returns {Promise} p
   */
  cancelOrderWithCid (params, cb = null) {
    const { cid, date } = params
    return this._makeAuthRequest('/auth/w/order/cancel', { cid, cid_date: date }, cb)
      .then(_takeResNotify)
  }

  /**
   * Submit multiple orders.
   *
   * @param {object} params                     - parameters
   * @param {Array&lt;Order|object>} params.orders - list of orders (can be object literal or Order class instance)
   * @param {Function} [cb]                     - legacy callback
   * @returns {Promise} p
   */
  submitOrderMulti (params, cb = null) {
    const { orders } = params
    if (!Array.isArray(orders)) {
      const e = new Error('orders should be an array')
      return this._cb(e, null, cb)
    }

    const payload = orders.map((order) => {
      // generate new packet from instance of Order class to ensure consistent payload signature
      const packet = (order instanceof Order ? order : new Order(order)).toNewOrderPacket()
      if (this._affCode) {
        packet.meta.aff_code = packet.meta.aff_code || this._affCode
      }

      return ['on', packet]
    })

    return this._makeAuthRequest('/auth/w/order/multi', { ops: payload }, cb)
      .then(_takeResNotify)
  }

  /**
   * Update multiple orders.
   *
   * @param {object} params                     - parameters
   * @param {Array&lt;Order|object>} params.orders - list of orders (can be object literal or Order class instance)
   * @param {Function} [cb]                     - legacy callback
   * @returns {Promise} p
   */
  updateOrderMulti (params, cb = null) {
    const { orders } = params
    if (!Array.isArray(orders)) {
      const e = new Error('orders should be an array')
      return this._cb(e, null, cb)
    }

    const payload = orders.map((order) => {
      return ['ou', order]
    })

    return this._makeAuthRequest('/auth/w/order/multi', { ops: payload }, cb)
      .then(_takeResNotify)
  }

  /**
   * Cancel orders.
   *
   * @param {object} params         - parameters
   * @param {number[]} params.ids   - list of order ids to cancel
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   */
  cancelOrders (params, cb = null) {
    const { ids } = params
    if (!Array.isArray(ids)) {
      const e = new Error('ids should be an array')
      return this._cb(e, null, cb)
    }

    const payload = ['oc_multi', { id: ids }]

    return this._makeAuthRequest('/auth/w/order/multi', { ops: [payload] }, cb)
      .then(_takeResNotify)
  }

  /**
   * @typedef {object} MultiOrderOpPayload
   * @property {number|number[]} [id] - array of order IDs or single order ID
   */

  /**
   * @typedef {Array} MultiOrderOp
   * @property {string} 0 - operation, i.e. 'oc', 'on', 'oc_multi', 'ou'
   * @property {MultiOrderOpPayload|Order} 1 - payload, i.e. { id: [1, 2] }
   */

  /**
   * Send Multiple order-related operations.
   *
   * @param {object} params             - parameters
   * @param {MultiOrderOp[]} params.ops - array of order operations
   * @param {Function} [cb]             - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-auth-order-multi
   */
  orderMultiOp (params, cb = null) {
    let { ops } = params
    if (!Array.isArray(ops)) {
      const e = new Error('ops should be an array')
      return this._cb(e, null, cb)
    }

    if (ops.some((op) => !Array.isArray(op))) {
      const e = new Error('ops should contain only arrays')
      return this._cb(e, null, cb)
    }

    ops = ops.map((op) => {
      if (op[0] === 'on' &amp;&amp; op[1]) {
        // to ensure consistent payload signature
        // generate new packet from instance of Order class
        const packet = (
          op[1] instanceof Order
            ? op[1]
            : new Order(op[1])
        ).toNewOrderPacket()

        if (this._affCode) {
          packet.meta.aff_code = packet.meta.aff_code || this._affCode
        }

        // update the payload order with enriched one
        op[1] = packet
      }
      return op
    })

    return this._makeAuthRequest('/auth/w/order/multi', { ops }, cb)
      .then(_takeResNotify)
  }

  /**
   * @typedef {Array} ClientOrderIdPayload
   * @property {number} 0 - client order ID
   * @property {string} 1 - client order ID date i.e. '2020-05-28'
   */

  /**
   * Cancel multiple orders simultaneously.
   *
   * @param {object} params                       - Cancel order parameters
   * @param {number[]} [params.id]                - array of order ID's
   * @param {number[]} [params.gid]               - array of group ID's
   * @param {ClientOrderIdPayload[]} [params.cid] - i.e. [[ 1234, 2020-05-28']]
   * @param {number} [params.all]                 - flag, i.e. 1 to cancel all open orders
   * @param {Function} [cb]                       - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-auth-order-cancel-multi
   */
  cancelOrderMulti (params, cb = null) {
    return this._makeAuthRequest('/auth/w/order/cancel/multi', params, cb)
      .then(_takeResNotify)
  }

  /**
   * Claim existing open position
   *
   * @param {object} params    - parameters
   * @param {number} params.id - position id
   * @param {Function} [cb]    - legacy callback
   * @returns {Promise} p
   */
  claimPosition (params, cb = null) {
    const { id } = params
    return this._makeAuthRequest('/auth/w/position/claim', { id }, cb)
      .then(_takeResNotify)
  }

  /**
   * Submit new funding offer
   *
   * @param {object} params             - parameters
   * @param {FundingOffer} params.offer - offer model instance
   * @param {Function} [cb]             - legacy callback
   * @returns {Promise} p
   */
  submitFundingOffer (params, cb = null) {
    const { offer } = params
    const packet = offer.toNewOfferPacket()

    if (this._affCode) {
      if (!packet.meta) {
        packet.meta = {}
      }

      packet.meta.aff_code = packet.meta.aff_code || this._affCode // eslint-disable-line
    }

    return this._makeAuthRequest('/auth/w/funding/offer/submit', packet, cb)
      .then(_takeResNotify)
  }

  /**
   * Cancel existing funding offer
   *
   * @param {object} params    - parameters
   * @param {number} params.id - offer id
   * @param {Function} [cb]    - legacy callback
   * @returns {Promise} p
   */
  cancelFundingOffer (params, cb = null) {
    const { id } = params
    return this._makeAuthRequest('/auth/w/funding/offer/cancel', { id }, cb)
      .then(_takeResNotify)
  }

  /**
   * Cancel all existing funding offers
   *
   * @param {object} params          - parameters
   * @param {string} params.currency - currency i.e USD
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   */
  cancelAllFundingOffers (params, cb = null) {
    const { currency } = params
    return this._makeAuthRequest('/auth/w/funding/offer/cancel/all', { currency }, cb)
      .then(_takeResNotify)
  }

  /**
   * Close funding
   *
   * @param {object} params      - parameters
   * @param {number} params.id   - funding id
   * @param {string} params.type - funding type LIMIT | FRRDELTAVAR
   * @param {Function} [cb]      - legacy callback
   * @returns {Promise} p
   */
  closeFunding (params, cb = null) {
    const { id, type } = params
    return this._makeAuthRequest('/auth/w/funding/close', { id, type }, cb)
      .then(_takeResNotify)
  }

  /**
   * Submit automatic funding
   *
   * @param {object} params          - parameters
   * @param {number} params.status   - status
   * @param {string} params.currency - currency i.e fUSD
   * @param {number} params.amount   - amount to borrow/lend
   * @param {number} params.rate     - if == 0 then FRR is used
   * @param {number} params.period   - time the offer remains locked in for
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   */
  submitAutoFunding (params, cb = null) {
    return this._makeAuthRequest('/auth/w/funding/auto', params, cb)
      .then(_takeResNotify)
  }

  /**
   * Execute a balance transfer between wallets
   *
   * @param {object} params            - parameters
   * @param {string} params.amount     - amount to transfer
   * @param {string} params.from       - wallet from
   * @param {string} params.to         - wallet to
   * @param {string} params.currency   - currency from
   * @param {string} params.currencyTo - currency to
   * @param {Function} [cb]            - legacy callback
   * @returns {Promise} p
   */
  transfer (params, cb = null) {
    const opts = _pick(params, ['amount', 'from', 'to', 'currency'])
    opts.currency_to = params.currencyTo
    return this._makeAuthRequest('/auth/w/transfer', opts, cb)
      .then(_takeResNotify)
  }

  /**
   * @param {object} params         - parameters
   * @param {string} params.wallet  - wallet i.e exchange, margin
   * @param {string} params.method  - protocol method i.e bitcoin, tetherus
   * @param {number} params.opRenew - if 1 then generates a new address
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   */
  getDepositAddress (params, cb = null) {
    const opts = _pick(params, ['wallet', 'method'])
    opts.op_renew = params.opRenew
    return this._makeAuthRequest('/auth/w/deposit/address', opts, cb)
      .then(_takeResNotify)
  }

  /**
   * @param {object} params         - parameters
   * @param {string} params.wallet  - wallet i.e exchange, margin
   * @param {string} params.method  - protocol method i.e bitcoin, tetherus
   * @param {number} params.amount  - amount to withdraw
   * @param {string} params.address - destination address
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   */
  withdraw (params, cb = null) {
    return this._makeAuthRequest('/auth/w/withdraw', params, cb)
      .then(_takeResNotify)
  }

  /**
   * @param {object} params             - parameters
   * @param {string} params.title       - the title of your Pulse message
   * @param {string} params.content     - content of your Pulse message
   * @param {number} params.isPublic    - make Pulse message public
   * @param {string} params.isPin       - make Pulse message pinned
   * @param {string} params.attachments - Base64 encoded list of strings
   * @param {Function} [cb]             - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-auth-pulse-add
   */
  addPulse (params, cb = null) {
    return this._makeAuthRequest('/auth/w/pulse/add', params, cb, PulseMessage)
  }

  /**
   * @param {object} params             - parameters
   * @param {string} params.parent      - the parent id of the Pulse message
   * @param {string} params.content     - content of your Pulse message
   * @param {number} params.isPublic    - make Pulse message public
   * @param {string} params.isPin       - make Pulse message pinned
   * @param {string} params.attachments - Base64 encoded list of strings
   * @param {Function} [cb]             - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-auth-pulse-add
   */
  addPulseComment (params, cb = null) {
    const { parent = '' } = params || {}
    if (_isEmpty(parent)) {
      return this._cb(new Error('parent (pulse id value) is required for adding comments'), null, cb)
    }
    return this.addPulse(params, cb)
  }

  /**
   * @param {object} params             - parameters
   * @param {string} params.parent      - the parent id of the Pulse message
   * @param {number} params.isPublic    - fetched public comments of a pulse
   * @param {string} params.limit       - number of comments
   * @param {string} params.end         - fetch comments starting from a given time in milliseconds
   * @param {Function} [cb]             - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-public-pulse-hist
   */
  fetchPulseComments (params, cb = null) {
    const { parent = '' } = params || {}
    if (_isEmpty(parent)) {
      return this._cb(new Error('parent (pulse id value) is required for fetching comments'), null, cb)
    }
    return this.pulseHistory(params, cb)
  }

  /**
   * @param {object} params     - parameters
   * @param {string} params.pid - pulse id
   * @param {Function} [cb]     - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-auth-pulse-del
   */
  deletePulse (params, cb = null) {
    return this._makeAuthRequest('/auth/w/pulse/del', params, cb)
  }

  /**
   * @param {object} params          - parameters
   * @param {number} params.isPublic - allows you to receive the public pulse history with the UID_LIKED field
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-auth-pulse-hist
   */
  pulseHistory (params, cb = null) {
    return this._makeAuthRequest('/auth/r/pulse/hist', params, cb, PulseMessage)
  }

  /**
   * @param {object} params          - parameters
   * @param {string} params.currency - currency for which you wish to generate an invoice. Currently only LNX (Bitcoin Lightning Network) is available
   * @param {string} params.wallet   - wallet that will receive the invoice payment. Currently only 'exchange' is available
   * @param {string} params.amount   - amount that you wish to deposit (in BTC; min 0.000001, max 0.02)
   * @param {Function} [cb]          - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#rest-auth-deposit-invoice
   */
  generateInvoice (params, cb = null) {
    return this._makeAuthRequest('/auth/w/deposit/invoice', params, cb, Invoice)
  }

  /**
   * @param {object} params                                - invoice parameters
   * @param {string} params.amount                         - invoice amount in currency
   * @param {string} params.currency                       - invoice currency
   * @param {string[]} params.payCurrencies                - currencies in which invoice accepts the payments
   * @param {number} [params.duration]                     - optional, invoice expire time in seconds, minimal duration
   *                                                         is 5 mins and maximal duration is 3 days.
   *                                                         Default value is 15 minutes
   * @param {string} params.orderId                        - reference order identifier in merchant's platform
   * @param {string} [params.webhook]                      - the endpoint that will be called once the payment is
   *                                                         completed or expired
   * @param {string} [params.redirectUrl]                  - merchant redirect URL, this one is used in UI to redirect
   *                                                         customer to merchant's site once the payment is completed
   *                                                         or expired
   * @param {object} params.customerInfo                   - information related to customer against who the invoice
   *                                                         is issued
   * @param {string} params.customerInfo.nationality       - customer's nationality, alpha2 code or full country name
   *                                                         (alpha2 preffered)
   * @param {string} params.customerInfo.residCountry      - customer's residential country, alpha2 code or
   *                                                         full country name (alpha2 preffered)
   * @param {string} [params.customerInfo.residState]      - optional, customer's residential state/province
   * @param {string} params.customerInfo.residCity         - customer's residential city/town
   * @param {string} params.customerInfo.residZipCode      - customer's residential zip code/postal code
   * @param {string} params.customerInfo.residStreet       - customer's residential street address
   * @param {string} [params.customerInfo.residBuildingNo] - optional, customer's residential building number/name
   * @param {string} params.customerInfo.fullName          - customer's full name
   * @param {string} params.customerInfo.email             - customer's email address
   * @param {object} [params.meta]                         - metadata
   * @param {string} [params.meta.env]                     - merchant environment, allowed values: production, test,
   *                                                         staging, development
   * @param {string[]} [param.meta.tags]                   - invoice tags, max number of tags is 5 and max length of
   *                                                         tag is 5 characters
   * @param {Function} [cb]                                - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#submit-invoice
   */
  payInvoiceCreate (params, cb = null) {
    return this._makeAuthRequest('/auth/w/ext/pay/invoice/create', params, cb)
  }

  /**
   * @param {object} [params]       - query parameters
   * @param {string} [params.id]    - unique invoice identifier
   * @param {number} [params.start] - millisecond start time
   * @param {number} [params.end]   - millisecond end time
   * @param {number} [params.limit] - number of records (Max 100), default 10
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#invoice-list
   */
  payInvoiceList (params = {}, cb = null) {
    return this._makeAuthRequest('/auth/r/ext/pay/invoices', params, cb)
  }

  /**
   * @param {object} [params]           - query parameters
   * @param {number} [params.page]      - Current page, default 1 100
   * @param {number} [params.pageSize]  - Number of records per page, default 10, max 100
   * @param {string} [params.sort]      - Sort order, default asc, accepted values are asc and desc
   * @param {string} [params.sortField] - Sort field, default t, allowed values: t, amount, status
   * @param {string} [params.status]    - invoice status, allowed array item values are:
   *                                      CREATED, PENDING, COMPLETED, EXPIRED
   * @param {string[]} [params.fiat]    - fiat filter, should be array of strings
   * @param {string[]} [params.crypto]  - crypto filter, should be array of strings
   * @param {string} [params.id]        - unique invoice identifier
   * @param {string} [params.orderId]   - erchant order id
   * @param {Function} [cb]             - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference/invoice-list-paginated
   */
  payInvoiceListPaginated (params = {}, cb = null) {
    return this._makeAuthRequest('/auth/r/ext/pay/invoices/paginated', params, cb)
  }

  /**
   * @param {object} params             - query parameters
   * @param {string} params.id          - unique invoice identifier
   * @param {string} params.payCcy      - paid invoice currency, should be one of values under payCurrencies field
   *                                      on invoice
   * @param {number} [params.depositId] - movement/deposit Id linked to invoice as payment
   * @param {number} [params.ledgerId]  - ledger entry Id linked to invoice as payment, use either depositId
   *                                      or ledgerId
   * @param {Function} [cb]             - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#complete-invoice
   */
  payInvoiceComplete (params, cb = null) {
    return this._makeAuthRequest('/auth/w/ext/pay/invoice/complete', params, cb)
  }

  /**
   * @param {object} params    - query parameters
   * @param {string} params.id - unique invoice identifier
   * @param {Function} [cb]    - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference/expire-invoice
   */
  payInvoiceExpire (params, cb = null) {
    return this._makeAuthRequest('/auth/w/ext/pay/invoice/expire', params, cb)
  }

  /**
   * @param {object} params         - query parameters
   * @param {string} params.ccy     - pay currency to search deposits for
   * @param {number} [params.start] - millisecond start time, if omitted it will be end - 1 day if end is present
   *                                  otherwise it will be yesterday. Min value is 1614758400000
   * @param {number} [params.end]   - Millisecond end time, if omitted it will be start + 1 day if start is present
   *                                  otherwise it will be current time. Max difference between start and end
   *                                  is 2 days!
   * @param {Function} [cb]         - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#complete-invoice
   */
  payDepositsUnlinked (params, cb = null) {
    return this._makeAuthRequest('/auth/r/ext/pay/deposits/unlinked', params, cb)
  }

  /**
   * @param {object} [params]           - query parameters
   * @param {number} [params.id]        - Deposit/Ledger entry Id to search for, use either id or from and to fields,
   *                                      id has priority over from, to fields
   * @param {number} [params.from]      - Millisecond start time
   * @param {number} [params.to]        - Millisecond end time
   * @param {string} [params.ccy]       - Pay currency to search deposits for
   * @param {boolean} [params.unlinked] - Include only unlinked payments
   * @param {Function} [cb]             - legacy callback
   * @returns {Promise} p
   * @see https://docs.bitfinex.com/reference#complete-invoice
   */
  payDeposits (params = {}, cb = null) {
    return this._makeAuthRequest('/auth/r/ext/pay/deposits', params, cb)
  }
}

RESTv2.url = API_URL

module.exports = RESTv2
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a> on Tue Apr 18 2023 12:54:59 GMT+0200 (Central European Summer Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
